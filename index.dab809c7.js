var _=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function i(e){e.forEach(t)}function a(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(e,t,n,i){if(e){const a=l(e,t,n,i);return e[0](a)}}function l(e,t,n,i){return e[1]&&i?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](i(t))):n.ctx}function s(e,t,n,i,a,o,r){const s=function(e,t,n,i){if(e[2]&&i){const a=e[2](i(n));if(void 0===t.dirty)return a;if("object"==typeof a){const e=[],n=Math.max(t.dirty.length,a.length);for(let i=0;i<n;i+=1)e[i]=t.dirty[i]|a[i];return e}return t.dirty|a}return t.dirty}(t,i,a,o);if(s){const a=l(t,n,i,r);e.p(a,s)}}function c(e,t){e.appendChild(t)}function u(e,t,n){e.insertBefore(t,n||null)}function f(e){e.parentNode.removeChild(e)}function d(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function h(e){return document.createElement(e)}function m(e){return document.createTextNode(e)}function p(){return m(" ")}function g(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function v(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function x(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function w(e,t){e.value=null==t?"":t}function $(e,t,n,i){e.style.setProperty(t,n,i?"important":"")}function _(e,t){for(let n=0;n<e.options.length;n+=1){const i=e.options[n];if(i.__value===t)return void(i.selected=!0)}}function b(e,t,n){e.classList[n?"add":"remove"](t)}let k;function E(e){k=e}function M(){if(!k)throw new Error("Function called outside component initialization");return k}function S(e){M().$$.on_mount.push(e)}const T=[],y=[],R=[],V=[],C=Promise.resolve();let F=!1;function A(e){R.push(e)}function D(e){V.push(e)}let B=!1;const z=new Set;function L(){if(!B){B=!0;do{for(let e=0;e<T.length;e+=1){const t=T[e];E(t),P(t.$$)}for(E(null),T.length=0;y.length;)y.pop()();for(let e=0;e<R.length;e+=1){const t=R[e];z.has(t)||(z.add(t),t())}R.length=0}while(T.length);for(;V.length;)V.pop()();F=!1,B=!1,z.clear()}}function P(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(A)}}const O=new Set;let I;function U(){I={r:0,c:[],p:I}}function N(){I.r||i(I.c),I=I.p}function H(e,t){e&&e.i&&(O.delete(e),e.i(t))}function X(e,t,n,i){if(e&&e.o){if(O.has(e))return;O.add(e),I.c.push((()=>{O.delete(e),i&&(n&&e.d(1),i())})),e.o(t)}}function G(e,t,n){const i=e.$$.props[t];void 0!==i&&(e.$$.bound[i]=n,n(e.$$.ctx[i]))}function q(e){e&&e.c()}function Y(e,n,o,r){const{fragment:l,on_mount:s,on_destroy:c,after_update:u}=e.$$;l&&l.m(n,o),r||A((()=>{const n=s.map(t).filter(a);c?c.push(...n):i(n),e.$$.on_mount=[]})),u.forEach(A)}function W(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function j(e,t){-1===e.$$.dirty[0]&&(T.push(e),F||(F=!0,C.then(L)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function K(t,a,o,r,l,s,c=[-1]){const u=k;E(t);const d=t.$$={fragment:null,ctx:null,props:s,update:e,not_equal:l,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:a.context||[]),callbacks:n(),dirty:c,skip_bound:!1};let h=!1;if(d.ctx=o?o(t,a.props||{},((e,n,...i)=>{const a=i.length?i[0]:n;return d.ctx&&l(d.ctx[e],d.ctx[e]=a)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](a),h&&j(t,e)),n})):[],d.update(),h=!0,i(d.before_update),d.fragment=!!r&&r(d.ctx),a.target){if(a.hydrate){const e=function(e){return Array.from(e.childNodes)}(a.target);d.fragment&&d.fragment.l(e),e.forEach(f)}else d.fragment&&d.fragment.c();a.intro&&H(t.$$.fragment),Y(t,a.target,a.anchor,a.customElement),L()}E(u)}class Z{$destroy(){W(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}var J="undefined"!=typeof Float32Array?Float32Array:Array;function Q(){var e=new J(9);return J!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ee(e,t,n){var i=t[0],a=t[1],o=t[2],r=t[3],l=t[4],s=t[5],c=t[6],u=t[7],f=t[8],d=n[0],h=n[1];return e[0]=i,e[1]=a,e[2]=o,e[3]=r,e[4]=l,e[5]=s,e[6]=d*i+h*r+c,e[7]=d*a+h*l+u,e[8]=d*o+h*s+f,e}function te(e,t,n){var i=n[0],a=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});class ne{constructor(e,t,n){this.vSharer=e,this.fSharer=t,this.program=n}useProgram(e){e.useProgram(this.program)}}function ie(e,t,n){const i=se(e,e.createShader(e.VERTEX_SHADER));e.shaderSource(i,t),e.compileShader(i),le(e,i);const a=se(e,e.createShader(e.FRAGMENT_SHADER));e.shaderSource(a,n),e.compileShader(a),le(e,a);const o=se(e,e.createProgram());return e.attachShader(o,i),e.attachShader(o,a),e.linkProgram(o),function(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error("linkig failed: "+e.getProgramInfoLog(t))}(e,o),new ne(i,a,o)}function ae(e,t){e.deleteProgram(t.program),e.deleteShader(t.vSharer),e.deleteShader(t.fSharer)}function oe(e,t,n){return function(e,t,n){const i=e.getAttribLocation(t,n);if(-1===i)throw new Error(`attribute '${n}' not found in program`);return i}(e,t.program,n)}function re(e,t,n){return function(e,t,n){const i=e.getUniformLocation(t,n);if(null===i)throw new Error(`uniform '${n}' not found in program`);return i}(e,t.program,n)}function le(e,t){const n=e.getShaderInfoLog(t);if(""!==n&&null!==n)throw new Error(n)}function se(e,t){if(null===t)throw new Error("gl error: "+e.getError());return t}function ce(e,t){null===t?(e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height)):(t.bind(e),e.viewport(0,0,t.width,t.height))}function ue(e,t,n,i={}){const{defaultTransfMat:a=Q(),beforeDraw:o=null}=i||{},r=oe(e,n,"aPosition");return e.enableVertexAttribArray(r),function(...i){t.bindToAttribute(e,r),n.useProgram(e),o&&o(...i),t.draw(e)}}class fe{constructor(e,t){this.fb=e,this.gfxTex=t}bind(e){e.bindFramebuffer(e.FRAMEBUFFER,this.fb)}get width(){return this.gfxTex.width}get height(){return this.gfxTex.height}}function de(e,t){const n=se(e,e.createFramebuffer()),i=new fe(n,t);return i.bind(e),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.tex,0),function(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(t){case e.FRAMEBUFFER_COMPLETE:return;case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.");case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment.");case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error("Height and width of the attachment are not the same.");case e.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or depth and stencil attachments are not the same renderbuffer.");default:throw new Error("unexpected frambuffer check result: "+t)}}(e),i}class he{constructor(e,t,n,i){this.mode=e,this.buf=t,this.vertexSize=n,this.count=i}bind(e){e.bindBuffer(e.ARRAY_BUFFER,this.buf)}bindToAttribute(e,t){this.bind(e),e.vertexAttribPointer(t,this.vertexSize,e.FLOAT,!1,0,0)}draw(e){e.drawArrays(this.mode,0,this.count)}}class me{constructor(e,t,n,i,a){this.tex=e,this.width=t,this.height=n,this.format=i,this.type=a}bind(e){e.bindTexture(e.TEXTURE_2D,this.tex)}}class pe{getFSParts(e){return{declaration:`uniform float uMaskSolid${e};`,usage:`uMaskSolid${e}`}}prepareFSUniforms(e,t,n){const i=re(e,t,`uMaskSolid${n}`);return(t,n)=>{e.uniform1f(i,n)}}}class ge{constructor(e){this.angle=e}getFSParts(e){const t="uMaskGradient"+e;return{declaration:`uniform vec2 ${t};`,usage:`mix(${t}.x, ${t}.y, clamp(0.5 + dot(vTextureCoord-0.5, vec2(${Math.cos(this.angle).toFixed(5)},${Math.sin(-this.angle).toFixed(5)})), 0., 1.))`}}prepareFSUniforms(e,t,n){const i=re(e,t,`uMaskGradient${n}`);return(t,n)=>{e.uniform2f(i,t,n)}}getAngleDeg(){return this.angle/Math.PI*180}}class ve{getFSParts(e){const t="uMaskCircle"+e;return{declaration:`uniform vec2 ${t};`,usage:`mix(${t}.x, ${t}.y, 1.-step(0.245, dot(vTextureCoord-0.5, vTextureCoord-0.5)))`}}prepareFSUniforms(e,t,n){const i=re(e,t,`uMaskCircle${n}`);return(t,n)=>{e.uniform2f(i,t,n)}}}class xe{getFSParts(e){const t="uMaskSmoothCircle"+e;return{declaration:`uniform vec2 ${t};`,usage:`mix(${t}.x, ${t}.y, clamp(1.-length((vTextureCoord-0.5)*2.), 0., 1.))`}}prepareFSUniforms(e,t,n){const i=re(e,t,`uMaskSmoothCircle${n}`);return(t,n)=>{e.uniform2f(i,t,n)}}}class we{constructor(e,t,n){this.minVal=e,this.maxVal=t,this.mask=n}}const $e="\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif",_e="\nprecision highp float;\n\nattribute vec2 aPosition;\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n\tvTextureCoord = aPosition;\n\tgl_Position = vec4((aPosition.xy-0.5)*2., 0, 1.);\n}",be=`\n${$e}\nprecision highp sampler2D;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec2 uScale;\n{{COEF_DECLARATIONS}}\n\nvoid main(void) {\n\t// vec4 c = texture2D(uSamplerCoefs, vTextureCoord);\n\tfloat diffusionRateA = {{diffusionRateA}};\n\tfloat diffusionRateB = {{diffusionRateB}};\n\tfloat feedRate = {{feedRate}};\n\tfloat killRate = {{killRate}};\n\tfloat timeDelta = {{timeDelta}};\n\n\tvec4 cur = texture2D(uSampler, vTextureCoord);\n\n\tvec2 laplacian = -cur.xy +\n\t\t0.2 * (\n\t\t\ttexture2D(uSampler, vTextureCoord + uScale*vec2(1, 0)).xy +\n\t\t\ttexture2D(uSampler, vTextureCoord + uScale*vec2(-1,0)).xy +\n\t\t\ttexture2D(uSampler, vTextureCoord + uScale*vec2(0, 1)).xy +\n\t\t\ttexture2D(uSampler, vTextureCoord + uScale*vec2(0,-1)).xy\n\t\t) + 0.05 * (\n\t\t\ttexture2D(uSampler, vTextureCoord + uScale*vec2(-1,-1)).xy +\n\t\t\ttexture2D(uSampler, vTextureCoord + uScale*vec2( 1,-1)).xy +\n\t\t\ttexture2D(uSampler, vTextureCoord + uScale*vec2( 1, 1)).xy +\n\t\t\ttexture2D(uSampler, vTextureCoord + uScale*vec2(-1, 1)).xy\n\t\t);\n\n\t/*\n\t// this should be faster theoretically but prctically compiler is smart enough and speed is same\n\tvec2 ab = cur.xy;\n\tfloat a = cur.x;\n\tfloat b = cur.y;\n\tfloat reactionValue = a * b * b;\n\tvec2 reaction = vec2(\n\t\t-reactionValue, //for a\n\t\treactionValue   //for b\n\t);\n\tvec2 ambient = vec2(\n\t\tfeedRate * (1. - a),       //for a\n\t\t-(killRate + feedRate) * b //for b\n\t);\n\tvec2 diffusionRate = vec2(diffusionRateA, diffusionRateB);\n\n\tvec2 newAB = ab + (diffusionRate * laplacian + reaction + ambient)*timeDelta;\n\tnewAB = clamp(newAB, 0., 1.);\n\tfloat change = (a-newAB.x) - (b-newAB.y);\n\n\tgl_FragColor = vec4(newAB, max(change, mix(change, cur.z, 0.99)), 1.);\n\t*/\n\n\tfloat a = cur.x;\n\tfloat b = cur.y;\n\tfloat reaction = a * b * b;\n\tfloat newA = a + (diffusionRateA * laplacian.x - reaction + feedRate * (1. - a)) * timeDelta;\n\tfloat newB = b + (diffusionRateB * laplacian.y + reaction - (killRate + feedRate) * b) * timeDelta;\n\tnewA = clamp(newA, 0., 1.);\n\tnewB = clamp(newB, 0., 1.);\n\tfloat change = (a-newA) - (b-newB);\n\tgl_FragColor = vec4(newA, newB, max(change, mix(change, cur.z, 0.99)), 1.);\n}`,ke={whiteBlack:"\n\t\tfloat c = clamp((field.x - field.y*1.5)*4., 0., 1.);\n\t\tvec3 color = vec3(c, c, c);\n\t",rgb:"\n\t\tfloat change = (abs(field.z)*200.);\n\t\tchange = change/(0.25+change)*1.333;\n\t\tvec3 color = vec3(change, field.x*0.5, field.y*1.5);\n\t",hsv:"\n\t\tfloat c = clamp((field.x - field.y), 0., 0.70);\n\t\tfloat change = (abs(field.z)*300.);\n\t\tchange = change/(0.5+change)*1.5;\n\t\tvec3 color = hsv2rgb(vec3(c, 1.-change*0.25, (0.75+c*0.25+change*0.25)));\n\t",darkSide:"\n\t\tfloat c = clamp((field.x - field.y), 0., 0.70);\n\t\tfloat change = (abs(field.z)*300.);\n\t\tchange = change/(0.5+change)*1.5;\n\t\tvec3 color = hsv2rgb(vec3(c, 1.-change*0.25, (0.75+c*0.25)*(0.1+change*0.9)));\n\t",green:"\n\t\tfloat c = clamp((field.x - field.y*1.5)*4., 0., 1.);\n\t\tvec3 color = vec3(c, 1.-field.y, field.x);\n\t",blueGreen:"\n\t\t// float change = (abs(field.z)*100.);\n\t\t// change = change/(0.25+change)*1.333;\n\t\t// float c = clamp((field.x - field.y*1.5)*0.85+0.15, 0., 1.);\n\t\t// vec3 color = rgb2hsv(vec3(c, 0.5, 0.5-change*0.5));\n\n\t\tfloat c = clamp((field.x - field.y*1.5)*0.85+0.15, 0., 1.);\n\t\tvec3 color = rgb2hsv(vec3(c, 0.5, 0.5));\n\t",changes:"\n\t\tfloat c = 1.-clamp((field.x - field.y*1.5)*4., 0., 1.);\n\t\tfloat change = (abs(field.z)*300.);\n\t\tchange = change/(0.25+change)*1.333;\n\t\tvec3 changeCol = field.z < 0. ? vec3(1.,0.15,0.15) : vec3(0.25,0.75,0.25);\n\t\tvec3 color = mix(vec3(c, c, c)*0.2, changeCol, change);\n\t",electric:"\n\t\tfloat change = (abs(field.z)*300.);\n\t\tchange = change/(0.5+change)*1.5;\n\t\tfloat c = clamp((field.x - field.y*1.5), 0., 1.);\n\t\tvec3 color = hsv2rgb(vec3(fract(0.54+c*0.2+change*0.1), 1.-change*change*0.5, 0.4+change*0.6));\n\t"},Ee=`\n${$e}\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec2 uOffset;\nuniform vec2 uSize;\nuniform lowp int uFrameVisible;\n\n// https://stackoverflow.com/a/17897228\nvec3 rgb2hsv(vec3 c)\n{\n\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n\tvec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n\tvec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n\tfloat d = q.x - min(q.w, q.y);\n\tfloat e = 1.0e-10;\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvoid main(void) {\n\tvec2 pos = vTextureCoord*uSize + uOffset;\n\tvec4 field = texture2D(uSampler, pos);\n\n\tvec2 innerRect = step(0., pos) * step(-1., -pos);\n\tvec2 outerRect = step(-0.005, pos) * step(-1.005, -pos);\n\tfloat isIn = uFrameVisible > 0\n\t\t? (min(innerRect.x, innerRect.y)*0.8+0.2) + (1.-min(outerRect.x, outerRect.y))*0.4\n\t\t: 1.;\n\n\t{{COLOR_CONV}}\n\n\tgl_FragColor = vec4(mix(vec3(0.5), color, isIn), 1.);\n}`,Me=`\n${$e}\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\n\nvoid main(void) {\n\tgl_FragColor = texture2D(uSampler, vTextureCoord);\n}`,Se=`\n${$e}\nuniform vec4 uColor;\n\nvoid main(void) {\n\tgl_FragColor = uColor;\n}`;class Te{constructor(e,t,n){this.gl=e,this.width=t,this.height=n,this.wrapMode="repeat",this.frameIsVisible=!0,this.iteration=null,this.result=null,this.fieldTextureType=(()=>{const t=e.getExtension("OES_texture_float"),n=e.getExtension("WEBGL_color_buffer_float");if(t&&n)return e.FLOAT;const i=e.getExtension("OES_texture_half_float"),a=e.getExtension("EXT_color_buffer_half_float");if(i&&a)return i.HALF_FLOAT_OES;throw new Error("девайс/браузер не поддерживает достаточную точность вычислений на видеокарте")})(),this.fieldTextureMinFilter=(()=>{const t=this.isHighpSupported()?"OES_texture_float_linear":"OES_texture_half_float_linear";return e.getExtension(t)?e.LINEAR:e.NEAREST})(),this.curFB=de(e,this.makeFieldTexture(t,n)),this.nextFB=de(e,this.makeFieldTexture(t,n)),this.clear();this.rect=function(e,t,n,i){t instanceof Array&&(t=new Float32Array(t));const a=se(e,e.createBuffer());return e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),new he(i,a,n,t.length/n|0)}(e,[0,0,0,1,1,1,1,1,1,0,0,0],2,e.TRIANGLES);const i=new pe;this.coefs={diffusionRateA:new we(1,1,i),diffusionRateB:new we(.5,.5,i),feedRate:new we(.055,.055,i),killRate:new we(.062,.062,i),timeDelta:new we(1,1,i)},this.masks=[i,new ge(0),new ge(3*Math.PI/2),new ge(Math.PI/4),new ge(7*Math.PI/4),new ve,new xe],this.colorMode="green",this.updateIterationData(),this.updateResultData();const a=ie(e,_e,Me);this.drawCopy=ue(e,this.rect,a);const o=ie(e,"\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform mat3 uTransform;\n\nvoid main(void) {\n\tgl_Position = vec4(((uTransform*vec3(aPosition, 1.)).xy-0.5)*2., 0, 1.);\n}",Se),r=re(e,o,"uTransform"),l=re(e,o,"uColor");this.drawLineInner=ue(e,this.rect,o,{beforeDraw:(t,n,i,a,o)=>{const s=Math.sqrt((i-t)**2+(n-a)**2),c=Math.atan2(a-n,i-t),u=Q();ee(u,u,[0,1]),te(u,u,[1,-1]),ee(u,u,[t/this.width,n/this.height]),function(e,t,n){var i=t[0],a=t[1],o=t[2],r=t[3],l=t[4],s=t[5],c=t[6],u=t[7],f=t[8],d=Math.sin(n),h=Math.cos(n);e[0]=h*i+d*r,e[1]=h*a+d*l,e[2]=h*o+d*s,e[3]=h*r-d*i,e[4]=h*l-d*a,e[5]=h*s-d*o,e[6]=c,e[7]=u,e[8]=f}(u,u,c),te(u,u,[s/this.width,3/this.height]),ee(u,u,[0,-.5]);const[f,d]=o||[0,1];e.uniform4f(l,f,d,0,0),e.uniformMatrix3fv(r,!1,u)}})}makeFieldTexture(e,t){const n=this.gl,i=function(e,t,n,i,a,o=null){const r=se(e,e.createTexture()),l=new me(r,t,n,i,a);return l.bind(e),e.texImage2D(e.TEXTURE_2D,0,i,t,n,0,i,a,o),l}(n,e,t,n.RGBA,this.fieldTextureType,null);return n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.fieldTextureMinFilter),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),i}iter(e){const t=this.gl;for(let n=0;n<e;n++)ce(t,this.nextFB),t.activeTexture(t.TEXTURE0),this.curFB.gfxTex.bind(t),this.iteration&&this.iteration.draw(),[this.curFB,this.nextFB]=[this.nextFB,this.curFB]}draw(e){ce(this.gl,null),this.curFB.gfxTex.bind(this.gl),this.result&&this.result.draw(e)}updateIterationData(){const e=this.gl;this.iteration&&ae(e,this.iteration.prog);const t=Object.entries(this.coefs);let n=be,i="";for(const[e,a]of t){const{declaration:t,usage:o}=a.mask.getFSParts("_"+e);i+=t+"\n",n=n.replace(`{{${e}}}`,o)}n=n.replace("{{COEF_DECLARATIONS}}",i);const a=ie(e,_e,n),o=[];for(const[n,i]of t)o.push(i.mask.prepareFSUniforms(e,a,"_"+n));const r=re(e,a,"uScale"),l=re(e,a,"uSampler"),s=ue(e,this.rect,a,{beforeDraw:()=>{e.uniform2f(r,1/this.width,1/this.height),e.uniform1i(l,0);for(let e=0;e<t.length;e++){const n=t[e][1];o[e](n.minVal,n.maxVal)}}});this.iteration={prog:a,draw:s}}updateResultData(){const e=this.gl;this.result&&ae(e,this.result.prog);const t=Ee.replace("{{COLOR_CONV}}",ke[this.colorMode]),n=ie(e,_e,t),i=re(e,n,"uOffset"),a=re(e,n,"uSize"),o=re(e,n,"uFrameVisible"),r=ue(e,this.rect,n,{beforeDraw:t=>{if(null===t)e.uniform2f(i,0,0),e.uniform2f(a,1,1),e.uniform1i(o,0);else{const{width:n,height:r}=e.canvas;e.uniform2f(i,-t.x/t.width,-t.y/t.height),e.uniform2f(a,n/t.width,r/t.height),e.uniform1i(o,this.frameIsVisible?1:0)}}});this.result={prog:n,draw:r}}updateTexWrapMode(){const e=this.gl,t="repeat"===this.wrapMode?e.REPEAT:e.MIRRORED_REPEAT;for(const n of[this.curFB,this.nextFB])n.gfxTex.bind(e),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t)}resizeFB(e,t,n){const i=this.gl;!function(e,t,n,i,a=null){t.bind(e);const{format:o,type:r}=t;e.texImage2D(e.TEXTURE_2D,0,o,n,i,0,o,r,a),t.width=n,t.height=i}(i,e.gfxTex,t,n),e.bind(i),i.clear(i.COLOR_BUFFER_BIT)}resize(e,t){const n=this.gl;this.resizeFB(this.nextFB,e,t),ce(n,this.nextFB),this.curFB.gfxTex.bind(n),this.drawCopy(),this.resizeFB(this.curFB,e,t),ce(n,this.curFB),this.nextFB.gfxTex.bind(n),this.drawCopy(),this.width=e,this.height=t}clear(){const e=this.gl;e.clearColor(1,0,0,0);for(const t of[this.curFB,this.nextFB])t.bind(e),e.clear(e.COLOR_BUFFER_BIT)}drawDot(e,t,n){this.drawLine(e-1.5,t,e+1.5,t,n)}drawLine(e,t,n,i,a){ce(this.gl,this.curFB),this.drawLineInner(e,t,n,i),e>n&&([e,n]=[n,e],[t,i]=[i,t]),e===n&&(n+=.001);const o=(i-t)/(n-e);let r=e,l=t,s=Math.floor(e/this.width),c=Math.floor(t/this.height),u=0;for(;r<n;){const f=s*this.width,d=c*this.height;this.drawLineInner(e-f,t-d,n-f,i-d,a);const h=l+(f+this.width-r)*o;if(h<d?(r+=(l-d)/-o,l=d,c-=1):h>d+this.height?(r+=(d+this.height-l)/o,l=d+this.height,c+=1):(r=f+this.width,l=h,s+=1),u++>10){console.error("drawLine looped too much!");break}}}isHighpSupported(){return this.fieldTextureType===this.gl.FLOAT}getMaxFieldSize(){return this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)}getSize(){return[this.width,this.height]}getCoefs(){return this.coefs}getMasks(){return this.masks}getWrapMode(){return this.wrapMode}setWrapMode(e){this.wrapMode=e,this.updateTexWrapMode()}getColorMode(){return this.colorMode}setColorMode(e){this.colorMode=e,this.updateResultData()}isFrameVisible(){return this.frameIsVisible}toggleFrame(e){this.frameIsVisible=e}}function ye(e){const{startElem:t,callbacks:n}=e,i=e.moveElem??window,a=e.offsetElem??t,o=e.leaveElem??t,{singleDown:r=Re,singleMove:l=Re,singleUp:s=Re}=n,{singleHover:c=Re,singleLeave:u=Re,wheelRot:f=Re}=n;let d=null;const h=Ve(a),m=h((function(e,t,n){return 0==e.button&&(De(M),De(S),Be(y),r(e,"mouse",e.clientX+t,e.clientY+n))})),p=h((function(e,t,n){return l(e,"mouse",e.clientX+t,e.clientY+n)})),g=h((function(e,t,n){return 0==e.button&&(Be(M),Be(S),De(y),s(e,"mouse"))})),v=h((function(e,t,n){return c(e,e.clientX+t,e.clientY+n)})),x=h((function(e,t,n){return u(e,e.clientX+t,e.clientY+n)})),w=h((function(e,t,n){if(null!==d)return!1;De(C),De(F),De(A);const i=e.changedTouches[0];return d=i.identifier,r(e,d,i.clientX+t,i.clientY+n)})),$=h((function(e,t,n){if(null!==d){const i=function(e,t){const n=Ae(e,t);if(null===n)throw new Error(`touch #${t} not found`);return n}(e.changedTouches,d);return l(e,d,i.clientX+t,i.clientY+n)}})),_=h((function(e,t,n){if(null===d)return!1;const i=Ae(e.changedTouches,d);return null!==i&&(d=null,Be(C),Be(F),Be(A),s(e,i.identifier))})),b=h((function(e,t,n){_(e)})),k=Ce(h,f),E=[t,"mousedown",m],M=[i,"mousemove",p],S=[i,"mouseup",g],T=[t,"wheel",k],y=[t,"mousemove",v],R=[o,"mouseleave",x],V=[t,"touchstart",w],C=[i,"touchmove",$],F=[i,"touchend",_],A=[i,"touchcancel",b];return Fe([E,M,S,y,R,T,V,C,F,A],[E,V,y,R,T])}function Re(){}function Ve(e){return function(t){return n=>{let i=0,a=0;"no-offset"!==e&&({left:i,top:a}=e.getBoundingClientRect()),t(n,-i,-a)&&n.preventDefault()}}}function Ce(e,t){const n=[];return n[WheelEvent.DOM_DELTA_PIXEL]=1,n[WheelEvent.DOM_DELTA_LINE]=20,n[WheelEvent.DOM_DELTA_PAGE]=50,e((function(e,i,a){const o=n[e.deltaMode];return t(e,e.deltaX*o,e.deltaY*o,e.deltaZ*o,e.clientX+i,e.clientY+a)}))}function Fe(e,t){let n=!1;function i(i){n!==(i=i??!n)&&(i?t.map(De):e.map(Be),n=i)}return i(!0),{toggle:i,get isOn(){return n},on(){i(!0)},off(){i(!1)}}}function Ae(e,t){for(let n=0;n<e.length;n++)if(e[n].identifier===t)return e[n];return null}function De(e){e[0].addEventListener(e[1],e[2],{capture:!0,passive:!1})}function Be(e){e[0].removeEventListener(e[1],e[2],{capture:!0})}function ze(e){let t,n;const i=e[2].default,a=r(i,e,e[1],null);return{c(){t=h("div"),a&&a.c(),v(t,"class","fake-portal svelte-w6x3o8")},m(i,o){u(i,t,o),a&&a.m(t,null),e[3](t),n=!0},p(e,[t]){a&&a.p&&2&t&&s(a,i,e,e[1],t,null,null)},i(e){n||(H(a,e),n=!0)},o(e){X(a,e),n=!1},d(n){n&&f(t),a&&a.d(n),e[3](null)}}}function Le(e,t,n){let{$$slots:i={},$$scope:a}=t,{fakeElem:o=null}=t;return S((()=>{const e=o.children[0],t=e.parentElement;return document.body.appendChild(e),()=>t.appendChild(e)})),e.$$set=e=>{"fakeElem"in e&&n(0,o=e.fakeElem),"$$scope"in e&&n(1,a=e.$$scope)},[o,a,i,function(e){y[e?"unshift":"push"]((()=>{o=e,n(0,o)}))}]}class Pe extends Z{constructor(e){super(),K(this,e,Le,ze,o,{fakeElem:0})}}function Oe(e){let t,n;const i=e[5].default,a=r(i,e,e[8],null);return{c(){t=h("div"),a&&a.c(),v(t,"class","tip-wrap svelte-rjc0lp"),$(t,"left",e[2]+"px"),$(t,"top",e[3]+"px")},m(i,o){u(i,t,o),a&&a.m(t,null),e[6](t),n=!0},p(e,o){a&&a.p&&256&o&&s(a,i,e,e[8],o,null,null),(!n||4&o)&&$(t,"left",e[2]+"px"),(!n||8&o)&&$(t,"top",e[3]+"px")},i(e){n||(H(a,e),n=!0)},o(e){X(a,e),n=!1},d(n){n&&f(t),a&&a.d(n),e[6](null)}}}function Ie(e){let t,n,i;function a(t){e[7](t)}let o={$$slots:{default:[Oe]},$$scope:{ctx:e}};return void 0!==e[0]&&(o.fakeElem=e[0]),t=new Pe({props:o}),y.push((()=>G(t,"fakeElem",a))),{c(){q(t.$$.fragment)},m(e,n){Y(t,e,n),i=!0},p(e,[i]){const a={};270&i&&(a.$$scope={dirty:i,ctx:e}),!n&&1&i&&(n=!0,a.fakeElem=e[0],D((()=>n=!1))),t.$set(a)},i(e){i||(H(t.$$.fragment,e),i=!0)},o(e){X(t.$$.fragment,e),i=!1},d(e){W(t,e)}}}function Ue(e,t,n){let i,a,{$$slots:o={},$$scope:r}=t,l=0,s=0,{origin:c}=t;return S((()=>{const e=a.getBoundingClientRect();if(c)n(2,({left:l,top:s}=c),l,n(3,s)),n(2,l-=e.width/2),n(3,s+=-e.height-12);else{const t=i.parentElement;if(t){const i=t.getBoundingClientRect();n(2,l=i.left),n(3,s=i.top-e.height-12)}}})),e.$$set=e=>{"origin"in e&&n(4,c=e.origin),"$$scope"in e&&n(8,r=e.$$scope)},[i,a,l,s,c,o,function(e){y[e?"unshift":"push"]((()=>{a=e,n(1,a)}))},function(e){i=e,n(0,i)},r]}class Ne extends Z{constructor(e){super(),K(this,e,Ue,Ie,o,{origin:4})}}function He(e){let t,n;return t=new Ne({props:{$$slots:{default:[Xe]},$$scope:{ctx:e}}}),{c(){q(t.$$.fragment)},m(e,i){Y(t,e,i),n=!0},i(e){n||(H(t.$$.fragment,e),n=!0)},o(e){X(t.$$.fragment,e),n=!1},d(e){W(t,e)}}}function Xe(e){let t,n,i,a,o,r,l;return{c(){t=m("Можно плавно изменять значение, если"),n=h("br"),i=m("\n\t\t\tпотянуть "),a=h("b"),a.textContent="стрелочку",o=m(" или покрутить "),r=h("b"),r.textContent="колёсико",l=m(" мыши.")},m(e,s){u(e,t,s),u(e,n,s),u(e,i,s),u(e,a,s),u(e,o,s),u(e,r,s),u(e,l,s)},d(e){e&&f(t),e&&f(n),e&&f(i),e&&f(a),e&&f(o),e&&f(r),e&&f(l)}}}function Ge(e){let t,n,a,o,r,l,s,d,m=e[4]&&qe<10&&He(e);return{c(){t=h("div"),n=h("input"),a=p(),o=h("div"),o.textContent="⭥",r=p(),m&&m.c(),n.value=e[0],v(n,"class","svelte-1qez1xa"),v(o,"class","slider svelte-1qez1xa"),v(t,"class","number-input-ext svelte-1qez1xa"),b(t,"grabbing",e[1])},m(i,f){u(i,t,f),c(t,n),c(t,a),c(t,o),e[8](o),c(t,r),m&&m.m(t,null),e[9](t),l=!0,s||(d=[g(n,"change",e[5]),g(t,"mouseover",e[10]),g(t,"mouseout",e[11])],s=!0)},p(e,[i]){(!l||1&i&&n.value!==e[0])&&(n.value=e[0]),e[4]&&qe<10?m?16&i&&H(m,1):(m=He(e),m.c(),H(m,1),m.m(t,null)):m&&(U(),X(m,1,1,(()=>{m=null})),N()),2&i&&b(t,"grabbing",e[1])},i(e){l||(H(m),l=!0)},o(e){X(m),l=!1},d(n){n&&f(t),e[8](null),m&&m.d(),e[9](null),s=!1,i(d)}}}let qe=0;function Ye(e,t,n){let i,a,{value:o}=t,{onChange:r}=t,{slideStep:l=1}=t,s=!1,c=!1;S((()=>{let e=0,t=0;const i=ye({startElem:a,callbacks:{singleDown:(i,a,r,l)=>(n(1,c=!0),e=o,t=l,!0),singleMove:(i,a,s,c)=>(n(0,o=e-(c-t)*l),qe++,r&&r(o),!0),singleUp:(e,t)=>(n(1,c=!1),!0)}});return()=>i.off()})),S((()=>{const e=function(e){const{startElem:t,wheelRot:n}=e;return Fe([],[[t,"wheel",Ce(Ve(e.offsetElem??t),n)]])}({startElem:i,offsetElem:"no-offset",wheelRot:(e,t,i,a,s,c)=>(n(0,o-=.02*i*l),qe++,r&&r(o),!0)});return()=>e.off()}));return e.$$set=e=>{"value"in e&&n(0,o=e.value),"onChange"in e&&n(6,r=e.onChange),"slideStep"in e&&n(7,l=e.slideStep)},e.$$.update=()=>{2&e.$$.dirty&&document.body.classList.toggle("grabbing",c)},[o,c,i,a,s,function(e){const t=+e.currentTarget.value;isNaN(t)?e.currentTarget.setCustomValidity("не число"):(n(0,o=t),r&&r(t),e.currentTarget.setCustomValidity(""))},r,l,function(e){y[e?"unshift":"push"]((()=>{a=e,n(3,a)}))},function(e){y[e?"unshift":"push"]((()=>{i=e,n(2,i)}))},()=>n(4,s=!0),()=>n(4,s=!1)]}class We extends Z{constructor(e){super(),K(this,e,Ye,Ge,o,{value:0,onChange:6,slideStep:7})}}function je(e,t,n){const i=e.slice();return i[14]=t[n],i[16]=n,i}function Ke(e){let t,n,i=e[6](e[14])+"";return{c(){t=h("option"),n=m(i),t.__value=e[16],t.value=t.__value},m(e,i){u(e,t,i),c(t,n)},p(e,t){4&t&&i!==(i=e[6](e[14])+"")&&x(n,i)},d(e){e&&f(t)}}}function Ze(e){let t,n,i,a,o,r;return t=new We({props:{value:e[0].minVal,onChange:e[8],slideStep:e[3]}}),{c(){q(t.$$.fragment),n=p(),i=h("button"),i.innerHTML='<div class="svelte-1e0rgh0">⇄</div>',v(i,"class","swap-button svelte-1e0rgh0")},m(l,s){Y(t,l,s),u(l,n,s),u(l,i,s),a=!0,o||(r=g(i,"click",e[7]),o=!0)},p(e,n){const i={};1&n&&(i.value=e[0].minVal),8&n&&(i.slideStep=e[3]),t.$set(i)},i(e){a||(H(t.$$.fragment,e),a=!0)},o(e){X(t.$$.fragment,e),a=!1},d(e){W(t,e),e&&f(n),e&&f(i),o=!1,r()}}}function Je(e){let t,n,i,a,o,r,l,s,w,b,k,E,M,S,T,y=e[5](e[0].mask),R=e[2],V=[];for(let t=0;t<R.length;t+=1)V[t]=Ke(je(e,R,t));let C=y&&Ze(e);return E=new We({props:{value:e[0].maxVal,onChange:e[9],slideStep:e[3]}}),{c(){t=h("div"),n=h("b"),i=m(e[1]),a=p(),o=h("div"),r=h("select");for(let e=0;e<V.length;e+=1)V[e].c();s=p(),w=h("br"),b=p(),C&&C.c(),k=p(),q(E.$$.fragment),$(o,"float","right"),v(o,"class","svelte-1e0rgh0"),v(t,"class","wrap svelte-1e0rgh0"),$(t,"padding-top",e[4])},m(l,f){u(l,t,f),c(t,n),c(n,i),c(t,a),c(t,o),c(o,r);for(let e=0;e<V.length;e+=1)V[e].m(r,null);_(r,e[2].findIndex(e[12])),c(t,s),c(t,w),c(t,b),C&&C.m(t,null),c(t,k),Y(E,t,null),M=!0,S||(T=g(r,"change",e[10]),S=!0)},p(e,[n]){if((!M||2&n)&&x(i,e[1]),68&n){let t;for(R=e[2],t=0;t<R.length;t+=1){const i=je(e,R,t);V[t]?V[t].p(i,n):(V[t]=Ke(i),V[t].c(),V[t].m(r,null))}for(;t<V.length;t+=1)V[t].d(1);V.length=R.length}(!M||5&n&&l!==(l=e[2].findIndex(e[12])))&&_(r,e[2].findIndex(e[12])),1&n&&(y=e[5](e[0].mask)),y?C?(C.p(e,n),1&n&&H(C,1)):(C=Ze(e),C.c(),H(C,1),C.m(t,k)):C&&(U(),X(C,1,1,(()=>{C=null})),N());const a={};1&n&&(a.value=e[0].maxVal),8&n&&(a.slideStep=e[3]),E.$set(a),(!M||16&n)&&$(t,"padding-top",e[4])},i(e){M||(H(C),H(E.$$.fragment,e),M=!0)},o(e){X(C),X(E.$$.fragment,e),M=!1},d(e){e&&f(t),d(V,e),C&&C.d(),W(E),S=!1,T()}}}function Qe(e,t,n){let{label:i}=t,{coef:a}=t,{masks:o}=t,{onMaskChange:r}=t,{slideStep:l}=t,{paddingTop:s=""}=t;const c={0:"🡒",45:"🡖",90:"🡓",270:"🡑",315:"🡕"};function u(e){return!(e instanceof pe)}return e.$$set=e=>{"label"in e&&n(1,i=e.label),"coef"in e&&n(0,a=e.coef),"masks"in e&&n(2,o=e.masks),"onMaskChange"in e&&n(11,r=e.onMaskChange),"slideStep"in e&&n(3,l=e.slideStep),"paddingTop"in e&&n(4,s=e.paddingTop)},[a,i,o,l,s,u,function(e){if(e instanceof pe)return"сплошная ■";if(e instanceof ge){const t=Math.round(e.getAngleDeg());return`градиент ${c[t]||t.toFixed(0)+"°"}`}return e instanceof ve?"круг ⬤︎":e instanceof xe?"пятно ☀":"???"},function(){n(0,[a.minVal,a.maxVal]=[a.maxVal,a.minVal],a)},function(e){n(0,a.minVal=e,a)},function(e){n(0,a.maxVal=e,a),a.mask instanceof pe&&n(0,a.minVal=e,a)},function(e){const t=a.mask;n(0,a.mask=o[e.currentTarget.value],a),!u(t)&&u(a.mask)&&a.minVal===a.maxVal&&n(0,a.minVal=3*a.maxVal/4,a),r()},r,e=>e===a.mask]}class et extends Z{constructor(e){super(),K(this,e,Qe,Je,o,{label:1,coef:0,masks:2,onMaskChange:11,slideStep:3,paddingTop:4})}}const tt=e=>({}),nt=e=>({}),it=e=>({}),at=e=>({});function ot(e,t,n){const i=e.slice();return i[67]=t[n][0],i[68]=t[n][1],i}function rt(t){let n,i,a;return{c(){n=h("button"),n.textContent=">>",v(n,"class","link-like svelte-oufswu")},m(e,o){u(e,n,o),i||(a=g(n,"click",t[37]),i=!0)},p:e,d(e){e&&f(n),i=!1,a()}}}function lt(t){let n,i,a;return{c(){n=h("button"),n.textContent="<< скрыть (esc)",v(n,"class","link-like svelte-oufswu")},m(e,o){u(e,n,o),i||(a=g(n,"click",t[36]),i=!0)},p:e,d(e){e&&f(n),i=!1,a()}}}function st(e){let t,n,i,a,o,r=e[67]+"";function l(){return e[38](e[68])}return{c(){t=h("button"),n=m(r),i=h("br"),v(t,"class","link-like svelte-oufswu")},m(e,r){u(e,t,r),c(t,n),u(e,i,r),a||(o=g(t,"click",l),a=!0)},p(t,n){e=t},d(e){e&&f(t),e&&f(i),a=!1,o()}}}function ct(e){let t;return{c(){t=h("div"),t.textContent="девайс/браузер не поддерживает высокую точность вычислений на видеокарте, симуляция будет\n\t\t\t\t\tнеточной",v(t,"class","warn small wrap-words svelte-oufswu")},m(e,n){u(e,t,n)},d(e){e&&f(t)}}}function ut(e){let t;return{c(){t=h("span"),t.textContent="↔",v(t,"class","dir-icon svelte-oufswu")},m(e,n){u(e,t,n)},d(e){e&&f(t)}}}function ft(e){let t,n,i,a,o,r,l;return{c(){t=h("div"),n=h("span"),n.textContent="↕",i=h("input"),a=p(),o=m(e[10]),v(n,"class","dir-icon svelte-oufswu"),v(i,"type","range"),v(i,"min","5"),v(i,"max",e[12]),i.value=e[14],v(i,"class","svelte-oufswu")},m(s,f){u(s,t,f),c(t,n),c(t,i),c(t,a),c(t,o),r||(l=g(i,"input",e[22]),r=!0)},p(e,t){4096&t[0]&&v(i,"max",e[12]),16384&t[0]&&(i.value=e[14]),1024&t[0]&&x(o,e[10])},d(e){e&&f(t),r=!1,l()}}}function dt(e){let t,n,o,l,_,k,E,M,S,T,R,V,C,F,A,B,z,L,P,O,I,U,N,j,K,Z,J,Q,ee,te,ne,ie,ae,oe,re,le,se,ce,ue,fe,de,he,me,pe,ge,ve,xe,we,$e,_e,be,ke,Ee,Me,Se,Te,ye,Re,Ve,Ce,Fe,Ae,De,Be,ze,Le,Pe,Oe,Ie,Ue,Ne,He,Xe,Ge,qe,Ye,We,je,Ke,Ze,Je,Qe,dt,ht,mt,pt,gt,vt,xt,wt,$t,_t,bt,kt,Et,Mt,St,Tt,yt,Rt,Vt,Ct,Ft,At,Dt,Bt,zt,Lt,Pt,Ot,It,Ut,Nt,Ht,Xt,Gt,qt,Yt,Wt,jt,Kt,Zt,Jt,Qt,en,tn,nn,an,on,rn,ln,sn,cn,un,fn,dn,hn,mn,pn,gn,vn,xn,wn,$n,_n,bn,kn,En,Mn,Sn,Tn,yn,Rn,Vn,Cn,Fn,An,Dn,Bn,zn,Ln,Pn,On,In,Un,Nn,Hn,Xn,Gn,qn,Yn=!e[5].isHighpSupported();function Wn(e,t){return e[4]?lt:rt}let jn=Wn(e),Kn=jn(e),Zn=Object.entries(e[31]),Jn=[];for(let t=0;t<Zn.length;t+=1)Jn[t]=st(ot(e,Zn,t));const Qn=e[35].fps,ei=r(Qn,e,e[34],at),ti=e[35].ips,ni=r(ti,e,e[34],nt);let ii=Yn&&ct();function ai(t){e[52](t)}let oi={label:"a diffusion rate",onMaskChange:e[23],masks:e[5].getMasks(),slideStep:.001,paddingTop:"4px"};function ri(t){e[53](t)}void 0!==e[15]&&(oi.coef=e[15]),mt=new et({props:oi}),y.push((()=>G(mt,"coef",ai)));let li={label:"b diffusion rate",onMaskChange:e[23],masks:e[5].getMasks(),slideStep:.001,paddingTop:"7px"};function si(t){e[54](t)}void 0!==e[16]&&(li.coef=e[16]),vt=new et({props:li}),y.push((()=>G(vt,"coef",ri)));let ci={label:"feed rate",onMaskChange:e[23],masks:e[5].getMasks(),slideStep:1e-4,paddingTop:"7px"};function ui(t){e[55](t)}void 0!==e[18]&&(ci.coef=e[18]),$t=new et({props:ci}),y.push((()=>G($t,"coef",si)));let fi={label:"kill rate",onMaskChange:e[23],masks:e[5].getMasks(),slideStep:1e-4,paddingTop:"7px"};function di(t){e[56](t)}void 0!==e[17]&&(fi.coef=e[17]),kt=new et({props:fi}),y.push((()=>G(kt,"coef",ui)));let hi={label:"speed",onMaskChange:e[23],masks:e[5].getMasks(),slideStep:.01,paddingTop:"7px"};void 0!==e[19]&&(hi.coef=e[19]),St=new et({props:hi}),y.push((()=>G(St,"coef",di)));let mi=!e[8]&&ut(),pi=!e[8]&&ft(e);return{c(){t=h("div"),n=h("div"),Kn.c(),o=p(),l=h("button"),l.textContent="скриншот",_=p(),k=h("div"),E=h("div"),E.innerHTML='<h1>Reaction–Diffusion</h1> \n\t\t\t<p style="opacity:0.8">Симуляция двух (a и b)<br/>\n\t\t\t\tреагирующих друг с другом<br/>\n\t\t\t\tи рассеивающихся веществ.<br/> \n\t\t\t\t<a href="https://www.karlsims.com/rd.html">Подробнее</a>.</p>',M=p(),S=h("fieldset"),T=h("legend"),T.textContent="Пресеты",R=p(),V=h("button"),V.textContent="случайно",C=h("br"),F=p();for(let e=0;e<Jn.length;e+=1)Jn[e].c();A=p(),B=h("fieldset"),z=h("legend"),z.textContent="Статус",L=p(),P=h("div"),ei&&ei.c(),O=m(" FPS, "),ni&&ni.c(),I=m(" итераций/с"),U=p(),ii&&ii.c(),N=p(),j=h("fieldset"),K=h("legend"),K.textContent="Цвет",Z=p(),J=h("label"),Q=h("input"),ee=m("ч/б"),te=p(),ne=h("label"),ie=h("input"),ae=m("RGB"),oe=p(),re=h("label"),le=h("input"),se=m("HSV"),ce=p(),ue=h("label"),fe=h("input"),de=m("зелёный"),he=h("br"),me=p(),pe=h("label"),ge=h("input"),ve=m("сине-зелёный"),xe=p(),we=h("label"),$e=h("input"),_e=m("изменения"),be=h("br"),ke=p(),Ee=h("label"),Me=h("input"),Se=m("электро"),Te=p(),ye=h("label"),Re=h("input"),Ve=m("Тёмная сторона"),Ce=p(),Fe=h("fieldset"),Ae=h("legend"),Ae.textContent="Рисование",De=p(),Be=h("button"),Be.textContent="♻️",ze=m(" \n\t\t\t"),Le=h("button"),Le.textContent="|",Pe=p(),Oe=h("button"),Oe.textContent="||",Ie=p(),Ue=h("button"),Ue.textContent="|||",Ne=m(" \n\t\t\t"),He=h("button"),He.textContent="•",Xe=p(),Ge=h("button"),Ge.innerHTML='<div style="margin:0 -2px 0 -2px; transform:translateY(-2px)">𐬽</div>',qe=p(),Ye=h("button"),Ye.innerHTML='<div style="margin:0 -3px 0 -2px">𐬽</div> \n\t\t\t\t<div style="position:absolute;top:-3px;transform:translateX(-3px)">𐬼</div>',We=p(),je=h("div"),je.textContent="а ещё — мышкой/пальцем",Ke=p(),Ze=h("fieldset"),Je=h("legend"),Je.textContent="Симуляция",Qe=p(),dt=h("div"),dt.textContent="маска",ht=p(),q(mt.$$.fragment),gt=p(),q(vt.$$.fragment),wt=p(),q($t.$$.fragment),bt=p(),q(kt.$$.fragment),Mt=p(),q(St.$$.fragment),yt=p(),Rt=h("fieldset"),Vt=h("legend"),Vt.textContent="Размер",Ct=p(),Ft=h("div"),mi&&mi.c(),At=h("input"),Dt=p(),Bt=m(e[9]),zt=p(),Lt=h("label"),Pt=h("input"),Ot=m("квадрат"),It=p(),pi&&pi.c(),Ut=p(),Nt=h("fieldset"),Ht=h("legend"),Ht.textContent="Итераций за кадр",Xt=p(),Gt=h("span"),Gt.textContent="плавнее",qt=p(),Yt=h("input"),Wt=p(),jt=m(e[1]),Kt=p(),Zt=h("span"),Zt.textContent="быстрее",Jt=p(),Qt=h("fieldset"),en=h("legend"),en.textContent="Внешняя область",tn=p(),nn=h("div"),an=h("div"),on=h("label"),rn=h("input"),ln=m("повторять"),sn=h("br"),cn=p(),un=h("label"),fn=h("input"),dn=m("отразить"),hn=p(),mn=h("div"),mn.innerHTML="влияет на<br/>симуляцию",pn=p(),gn=h("div"),vn=h("label"),xn=h("input"),wn=m("отображать"),$n=h("br"),_n=p(),bn=h("label"),kn=h("input"),En=m("затемнять"),Mn=h("br"),Sn=p(),Tn=h("label"),yn=h("input"),Rn=m("скрыть"),Vn=p(),Cn=h("span"),Cn.textContent="быстрее",Fn=p(),An=h("div"),Dn=m("размер: "),Bn=h("input"),zn=p(),Ln=m(e[2]),Pn=p(),On=h("p"),On.innerHTML='Вдохновлено <a href="https://www.instagram.com/p/CGRCGcVHh4_/">постом в Инстаграме</a>',In=p(),Un=h("p"),Un.innerHTML='Исходники:<br/> \n\t\t\t<a href="https://github.com/3bl3gamer/reaction-diffusion">github.com/3bl3gamer/reaction-diffusion</a>',Nn=p(),Hn=h("p"),Hn.innerHTML='Ещё у меня есть<br/> \n\t\t\t<a href="https://3bl3gamer.github.io/fractal-chaos/">Генератор фракталов методом Хаоса</a><br/>\n\t\t\tи\n\t\t\t<a href="https://3bl3gamer.github.io/buddhabrot/">Генератор Буддабротов</a>',v(l,"class","link-like svelte-oufswu"),$(l,"float","right"),v(n,"class","cfg-head svelte-oufswu"),v(E,"class","info-block svelte-oufswu"),v(T,"class","svelte-oufswu"),v(V,"class","link-like random svelte-oufswu"),v(S,"class","cfg-presets svelte-oufswu"),v(z,"class","svelte-oufswu"),v(B,"class","svelte-oufswu"),v(K,"class","svelte-oufswu"),v(Q,"type","radio"),Q.__value="whiteBlack",Q.value=Q.__value,e[40][0].push(Q),v(ie,"type","radio"),ie.__value="rgb",ie.value=ie.__value,e[40][0].push(ie),v(le,"type","radio"),le.__value="hsv",le.value=le.__value,e[40][0].push(le),v(fe,"type","radio"),fe.__value="green",fe.value=fe.__value,e[40][0].push(fe),v(ge,"type","radio"),ge.__value="blueGreen",ge.value=ge.__value,e[40][0].push(ge),v($e,"type","radio"),$e.__value="changes",$e.value=$e.__value,e[40][0].push($e),v(Me,"type","radio"),Me.__value="electric",Me.value=Me.__value,e[40][0].push(Me),v(Re,"type","radio"),Re.__value="darkSide",Re.value=Re.__value,e[40][0].push(Re),v(j,"class","svelte-oufswu"),v(Ae,"class","svelte-oufswu"),v(Be,"class","svelte-oufswu"),v(Le,"class","svelte-oufswu"),v(Oe,"class","svelte-oufswu"),v(Ue,"class","svelte-oufswu"),v(He,"class","svelte-oufswu"),v(Ge,"class","svelte-oufswu"),$(Ye,"position","relative"),v(Ye,"class","svelte-oufswu"),v(je,"class","dim small"),$(je,"text-align","center"),v(Fe,"class","draw-cfg svelte-oufswu"),v(Je,"class","svelte-oufswu"),v(dt,"class","mask-label small svelte-oufswu"),v(Ze,"class","sim-cfg svelte-oufswu"),v(Vt,"class","svelte-oufswu"),v(At,"type","range"),v(At,"min","5"),v(At,"max",e[12]),At.value=e[13],v(At,"class","svelte-oufswu"),v(Pt,"type","checkbox"),v(Rt,"class","size-cfg svelte-oufswu"),v(Ht,"class","svelte-oufswu"),v(Gt,"class","dim"),v(Yt,"type","range"),v(Yt,"class","iters-input svelte-oufswu"),v(Yt,"min","1"),v(Yt,"max","16"),Yt.value=e[20],v(Zt,"class","dim"),v(Nt,"class","svelte-oufswu"),v(en,"class","svelte-oufswu"),v(rn,"type","radio"),rn.__value="repeat",rn.value=rn.__value,e[40][1].push(rn),v(fn,"type","radio"),fn.__value="mirror",fn.value=fn.__value,e[40][1].push(fn),v(mn,"class","small dim svelte-oufswu"),v(an,"class","column svelte-oufswu"),v(xn,"type","radio"),xn.__value="visible",xn.value=xn.__value,e[40][2].push(xn),v(kn,"type","radio"),kn.__value="darken",kn.value=kn.__value,e[40][2].push(kn),v(yn,"type","radio"),yn.__value="hidden",yn.value=yn.__value,e[40][2].push(yn),v(Cn,"class","small dim"),v(gn,"class","column svelte-oufswu"),v(nn,"class","switches svelte-oufswu"),v(Bn,"type","range"),v(Bn,"min","0"),v(Bn,"max","3"),v(Bn,"step","0.1"),v(Bn,"class","svelte-oufswu"),v(An,"class","svelte-oufswu"),v(Qt,"class","frame-cfg svelte-oufswu"),v(On,"class","small"),v(Un,"class","small"),v(Hn,"class","small"),v(k,"class","cfg-scroll svelte-oufswu"),v(t,"class","cfg-wrap svelte-oufswu"),b(t,"minimized",!e[4])},m(i,r){u(i,t,r),c(t,n),Kn.m(n,null),c(n,o),c(n,l),c(t,_),c(t,k),c(k,E),c(k,M),c(k,S),c(S,T),c(S,R),c(S,V),c(S,C),c(S,F);for(let e=0;e<Jn.length;e+=1)Jn[e].m(S,null);c(k,A),c(k,B),c(B,z),c(B,L),c(B,P),ei&&ei.m(P,null),c(P,O),ni&&ni.m(P,null),c(P,I),c(B,U),ii&&ii.m(B,null),c(k,N),c(k,j),c(j,K),c(j,Z),c(j,J),c(J,Q),Q.checked=Q.__value===e[7],c(J,ee),c(j,te),c(j,ne),c(ne,ie),ie.checked=ie.__value===e[7],c(ne,ae),c(j,oe),c(j,re),c(re,le),le.checked=le.__value===e[7],c(re,se),c(j,ce),c(j,ue),c(ue,fe),fe.checked=fe.__value===e[7],c(ue,de),c(j,he),c(j,me),c(j,pe),c(pe,ge),ge.checked=ge.__value===e[7],c(pe,ve),c(j,xe),c(j,we),c(we,$e),$e.checked=$e.__value===e[7],c(we,_e),c(j,be),c(j,ke),c(j,Ee),c(Ee,Me),Me.checked=Me.__value===e[7],c(Ee,Se),c(j,Te),c(j,ye),c(ye,Re),Re.checked=Re.__value===e[7],c(ye,Ve),c(k,Ce),c(k,Fe),c(Fe,Ae),c(Fe,De),c(Fe,Be),c(Fe,ze),c(Fe,Le),c(Fe,Pe),c(Fe,Oe),c(Fe,Ie),c(Fe,Ue),c(Fe,Ne),c(Fe,He),c(Fe,Xe),c(Fe,Ge),c(Fe,qe),c(Fe,Ye),c(Fe,We),c(Fe,je),c(k,Ke),c(k,Ze),c(Ze,Je),c(Ze,Qe),c(Ze,dt),c(Ze,ht),Y(mt,Ze,null),c(Ze,gt),Y(vt,Ze,null),c(Ze,wt),Y($t,Ze,null),c(Ze,bt),Y(kt,Ze,null),c(Ze,Mt),Y(St,Ze,null),c(k,yt),c(k,Rt),c(Rt,Vt),c(Rt,Ct),c(Rt,Ft),mi&&mi.m(Ft,null),c(Ft,At),c(Ft,Dt),c(Ft,Bt),c(Ft,zt),c(Ft,Lt),c(Lt,Pt),Pt.checked=e[8],c(Lt,Ot),c(Rt,It),pi&&pi.m(Rt,null),c(k,Ut),c(k,Nt),c(Nt,Ht),c(Nt,Xt),c(Nt,Gt),c(Nt,qt),c(Nt,Yt),c(Nt,Wt),c(Nt,jt),c(Nt,Kt),c(Nt,Zt),c(k,Jt),c(k,Qt),c(Qt,en),c(Qt,tn),c(Qt,nn),c(nn,an),c(an,on),c(on,rn),rn.checked=rn.__value===e[11],c(on,ln),c(an,sn),c(an,cn),c(an,un),c(un,fn),fn.checked=fn.__value===e[11],c(un,dn),c(an,hn),c(an,mn),c(nn,pn),c(nn,gn),c(gn,vn),c(vn,xn),xn.checked=xn.__value===e[0],c(vn,wn),c(gn,$n),c(gn,_n),c(gn,bn),c(bn,kn),kn.checked=kn.__value===e[0],c(bn,En),c(gn,Mn),c(gn,Sn),c(gn,Tn),c(Tn,yn),yn.checked=yn.__value===e[0],c(Tn,Rn),c(gn,Vn),c(gn,Cn),c(Qt,Fn),c(Qt,An),c(An,Dn),c(An,Bn),w(Bn,e[2]),c(An,zn),c(An,Ln),c(k,Pn),c(k,On),c(k,In),c(k,Un),c(k,Nn),c(k,Hn),e[64](t),Xn=!0,Gn||(qn=[g(window,"keydown",e[25]),g(l,"click",(function(){a(e[6])&&e[6].apply(this,arguments)})),g(V,"click",e[32]),g(Q,"change",e[39]),g(ie,"change",e[41]),g(le,"change",e[42]),g(fe,"change",e[43]),g(ge,"change",e[44]),g($e,"change",e[45]),g(Me,"change",e[46]),g(Re,"change",e[47]),g(Be,"click",e[48]),g(Le,"click",e[49]),g(Oe,"click",e[50]),g(Ue,"click",e[51]),g(He,"click",e[27]),g(Ge,"click",e[28]),g(Ye,"click",e[29]),g(At,"input",e[21]),g(Pt,"change",e[57]),g(Yt,"input",e[24]),g(rn,"change",e[58]),g(fn,"change",e[59]),g(xn,"change",e[60]),g(kn,"change",e[61]),g(yn,"change",e[62]),g(Bn,"change",e[63]),g(Bn,"input",e[63])],Gn=!0)},p(i,a){if(jn===(jn=Wn(e=i))&&Kn?Kn.p(e,a):(Kn.d(1),Kn=jn(e),Kn&&(Kn.c(),Kn.m(n,o))),1073741824&a[0]|1&a[1]){let t;for(Zn=Object.entries(e[31]),t=0;t<Zn.length;t+=1){const n=ot(e,Zn,t);Jn[t]?Jn[t].p(n,a):(Jn[t]=st(n),Jn[t].c(),Jn[t].m(S,null))}for(;t<Jn.length;t+=1)Jn[t].d(1);Jn.length=Zn.length}ei&&ei.p&&8&a[1]&&s(ei,Qn,e,e[34],a,it,at),ni&&ni.p&&8&a[1]&&s(ni,ti,e,e[34],a,tt,nt),32&a[0]&&(Yn=!e[5].isHighpSupported()),Yn?ii||(ii=ct(),ii.c(),ii.m(B,null)):ii&&(ii.d(1),ii=null),128&a[0]&&(Q.checked=Q.__value===e[7]),128&a[0]&&(ie.checked=ie.__value===e[7]),128&a[0]&&(le.checked=le.__value===e[7]),128&a[0]&&(fe.checked=fe.__value===e[7]),128&a[0]&&(ge.checked=ge.__value===e[7]),128&a[0]&&($e.checked=$e.__value===e[7]),128&a[0]&&(Me.checked=Me.__value===e[7]),128&a[0]&&(Re.checked=Re.__value===e[7]);const r={};32&a[0]&&(r.masks=e[5].getMasks()),!pt&&32768&a[0]&&(pt=!0,r.coef=e[15],D((()=>pt=!1))),mt.$set(r);const l={};32&a[0]&&(l.masks=e[5].getMasks()),!xt&&65536&a[0]&&(xt=!0,l.coef=e[16],D((()=>xt=!1))),vt.$set(l);const c={};32&a[0]&&(c.masks=e[5].getMasks()),!_t&&262144&a[0]&&(_t=!0,c.coef=e[18],D((()=>_t=!1))),$t.$set(c);const u={};32&a[0]&&(u.masks=e[5].getMasks()),!Et&&131072&a[0]&&(Et=!0,u.coef=e[17],D((()=>Et=!1))),kt.$set(u);const f={};32&a[0]&&(f.masks=e[5].getMasks()),!Tt&&524288&a[0]&&(Tt=!0,f.coef=e[19],D((()=>Tt=!1))),St.$set(f),e[8]?mi&&(mi.d(1),mi=null):mi||(mi=ut(),mi.c(),mi.m(Ft,At)),(!Xn||4096&a[0])&&v(At,"max",e[12]),(!Xn||8192&a[0])&&(At.value=e[13]),(!Xn||512&a[0])&&x(Bt,e[9]),256&a[0]&&(Pt.checked=e[8]),e[8]?pi&&(pi.d(1),pi=null):pi?pi.p(e,a):(pi=ft(e),pi.c(),pi.m(Rt,null)),(!Xn||1048576&a[0])&&(Yt.value=e[20]),(!Xn||2&a[0])&&x(jt,e[1]),2048&a[0]&&(rn.checked=rn.__value===e[11]),2048&a[0]&&(fn.checked=fn.__value===e[11]),1&a[0]&&(xn.checked=xn.__value===e[0]),1&a[0]&&(kn.checked=kn.__value===e[0]),1&a[0]&&(yn.checked=yn.__value===e[0]),4&a[0]&&w(Bn,e[2]),(!Xn||4&a[0])&&x(Ln,e[2]),16&a[0]&&b(t,"minimized",!e[4])},i(e){Xn||(H(ei,e),H(ni,e),H(mt.$$.fragment,e),H(vt.$$.fragment,e),H($t.$$.fragment,e),H(kt.$$.fragment,e),H(St.$$.fragment,e),Xn=!0)},o(e){X(ei,e),X(ni,e),X(mt.$$.fragment,e),X(vt.$$.fragment,e),X($t.$$.fragment,e),X(kt.$$.fragment,e),X(St.$$.fragment,e),Xn=!1},d(n){n&&f(t),Kn.d(),d(Jn,n),ei&&ei.d(n),ni&&ni.d(n),ii&&ii.d(),e[40][0].splice(e[40][0].indexOf(Q),1),e[40][0].splice(e[40][0].indexOf(ie),1),e[40][0].splice(e[40][0].indexOf(le),1),e[40][0].splice(e[40][0].indexOf(fe),1),e[40][0].splice(e[40][0].indexOf(ge),1),e[40][0].splice(e[40][0].indexOf($e),1),e[40][0].splice(e[40][0].indexOf(Me),1),e[40][0].splice(e[40][0].indexOf(Re),1),W(mt),W(vt),W($t),W(kt),W(St),mi&&mi.d(),pi&&pi.d(),e[40][1].splice(e[40][1].indexOf(rn),1),e[40][1].splice(e[40][1].indexOf(fn),1),e[40][2].splice(e[40][2].indexOf(xn),1),e[40][2].splice(e[40][2].indexOf(kn),1),e[40][2].splice(e[40][2].indexOf(yn),1),e[64](null),Gn=!1,i(qn)}}}function ht(e,t,n){let i,a,o,r,l,s,c,u,f,d,h,m,p,{$$slots:g={},$$scope:v}=t,{engine:x}=t,{frameSize:w}=t,{frameMode:$="darken"}=t,{itersPerFrame:_=24}=t,{onResize:b}=t,{onScreenshot:k}=t,{wrapElem:E}=t,{isShown:M=!0}=t,S="green",T=()=>x;function R(e){const[t,n]=x.getSize();for(let i=0;i<e;i++){const a=t/2+24*(i-(e-1)/2);x.drawLine(a,0,a,n)}}function V(){const[e,t]=x.getSize();x.drawDot(e/2,t/2)}function C(){const[e,t]=x.getSize();for(let n=0;n<3;n++){const i=n/3*2*Math.PI-Math.PI/2;x.drawDot(e/2+e/8*Math.cos(i),t/2+t/8*Math.sin(i))}}function F(){const[e,t]=x.getSize(),n=Math.max(5,Math.round(e*t/50/50));for(let i=0;i<n;i++)x.drawDot(e*Math.random(),t*Math.random())}function A(e){const t=x.getMasks().find(e);if(!t)throw new Error("mask not found");return t}function D(e){const t=x.getCoefs();for(const e in t)t[e].mask=x.getMasks().find((e=>e instanceof pe));n(15,c.minVal=n(15,c.maxVal=1,c),c),n(16,u.minVal=n(16,u.maxVal=.5,u),u),n(18,d.minVal=n(18,d.maxVal=.055,d),d),n(17,f.minVal=n(17,f.maxVal=.062,f),f),n(19,h.minVal=n(19,h.maxVal=1,h),h),n(11,m="repeat"),n(7,S="green"),x.clear(),e(),x.updateIterationData()}const B={"рождение Вселенной"(){n(18,d.minVal=.018,d),n(18,d.maxVal=.055,d),n(18,d.mask=A((e=>e instanceof xe)),d),n(7,S="darkSide"),V()},"дерево в рамке"(){n(15,c.minVal=n(15,c.maxVal=.9344339479362163,c),c),n(16,u.minVal=.6366397881990161,u),n(16,u.maxVal=.4177794651597456,u),n(16,u.mask=A((e=>e instanceof ge&&315===e.getAngleDeg())),u),n(18,d.minVal=.0847265052049363,d),n(18,d.maxVal=.014681911230716192,d),n(18,d.mask=A((e=>e instanceof ge&&315===e.getAngleDeg())),d),n(17,f.minVal=n(17,f.maxVal=.061886156571588954,f),f),n(7,S="blueGreen"),R(1)},"реактор"(){n(18,d.minVal=.055,d),n(18,d.maxVal=.0272,d),n(18,d.mask=A((e=>e instanceof ve)),d),n(17,f.minVal=.062,f),n(17,f.maxVal=.05,f),n(17,f.mask=A((e=>e instanceof xe)),f),n(19,h.minVal=n(19,h.maxVal=x.isHighpSupported()?.5:1,h),h),n(7,S="electric"),F()},"спирали"(){n(15,c.minVal=n(15,c.maxVal=0,c),c),n(16,u.minVal=n(16,u.maxVal=.5,u),u),n(18,d.minVal=n(18,d.maxVal=.015,d),d),n(17,f.minVal=n(17,f.maxVal=.045,f),f),n(19,h.minVal=n(19,h.maxVal=.3,h),h);const[e,t]=x.getSize(),[i,a]=[e/2,t/2],o=.2,r=e=>30*e,l=(e,t)=>[i+Math.cos(e)*(r(e)+t),a+Math.sin(e)*(r(e)+t)];for(let n=0;r(n)<Math.min(e/2,t/2);n+=o)x.drawLine(...l(n,0),...l(n+o,0),[.25,.2]),x.drawLine(...l(n,3),...l(n+o,3),[.25,.2]),x.drawLine(...l(n,6),...l(n+o,6),[.25,.2]),x.drawLine(...l(n,9),...l(n+o,9),[.25,.2]),x.drawLine(...l(n,12),...l(n+o,12),[0,1])},"спирали (красно-зелёные)"(){B.спирали(),n(7,S="changes")},"пульсация"(){n(15,c.minVal=n(15,c.maxVal=.2,c),c),n(16,u.minVal=n(16,u.maxVal=.8,u),u),n(18,d.minVal=n(18,d.maxVal=.018,d),d),n(17,f.minVal=.064,f),n(17,f.maxVal=.032,f),n(17,f.mask=A((e=>e instanceof xe)),f),n(19,h.minVal=n(19,h.maxVal=x.isHighpSupported()?.5:1,h),h),n(7,S="green"),V()},"кипящая жижа"(){n(18,d.minVal=.028,d),n(18,d.maxVal=.005,d),n(18,d.mask=A((e=>e instanceof ge&&270===e.getAngleDeg())),d),n(17,f.minVal=n(17,f.maxVal=.05,f),f),n(19,h.minVal=n(19,h.maxVal=x.isHighpSupported()?.5:.8,h),h);const[e,t]=x.getSize();x.drawDot(e/2,.8*t)},"фаербол"(){n(18,d.minVal=.01,d),n(18,d.maxVal=.02,d),n(18,d.mask=A((e=>e instanceof xe)),d),n(17,f.minVal=.059,f),n(17,f.maxVal=.04,f),n(17,f.mask=A((e=>e instanceof xe)),f),n(7,S="hsv"),n(19,h.minVal=n(19,h.maxVal=x.isHighpSupported()?.5:.8,h),h),C()},"кляксы"(){n(18,d.minVal=n(18,d.maxVal=.09,d),d),n(17,f.minVal=n(17,f.maxVal=.0576,f),f),n(7,S="blueGreen"),F()},"отпечаток пальца"(){n(15,c.minVal=.44,c),n(15,c.maxVal=1,c),n(15,c.mask=A((e=>e instanceof xe)),c),n(16,u.minVal=.414,u),n(16,u.maxVal=.473,u),n(16,u.mask=A((e=>e instanceof ge&&270===e.getAngleDeg())),u),n(18,d.minVal=n(18,d.maxVal=.035,d),d),n(17,f.minVal=n(17,f.maxVal=.059,f),f),n(7,S="whiteBlack"),F()},"чашка Петри"(){n(18,d.minVal=n(18,d.maxVal=.014,d),d),n(17,f.minVal=n(17,f.maxVal=.05,f),f),n(19,h.minVal=-.05,h),n(19,h.maxVal=1,h),n(19,h.mask=A((e=>e instanceof xe)),h),n(7,S="green"),V()},"деление клеток"(){if(n(18,d.minVal=n(18,d.maxVal=.03,d),d),n(17,f.minVal=n(17,f.maxVal=.0625,f),f),n(7,S="blueGreen"),V(),!x.isHighpSupported()){const[e,t]=x.getSize();x.drawLine(e/2-3,t/2,e/2+3,t/2)}},"круги и черви"(){n(18,d.minVal=n(18,d.maxVal=.082,d),d),n(17,f.minVal=n(17,f.maxVal=.06,f),f),n(7,S="blueGreen"),F()},"карта kill/feed"(){n(18,d.minVal=.01,d),n(18,d.maxVal=.1,d),n(18,d.mask=A((e=>e instanceof ge&&0===e.getAngleDeg())),d),n(17,f.minVal=.045,f),n(17,f.maxVal=.07,f),n(17,f.mask=A((e=>e instanceof ge&&270===e.getAngleDeg())),f),n(11,m="mirror");for(let e=0;e<10;e++)F()},"карта диффузий"(){n(15,c.minVal=.3,c),n(15,c.maxVal=1,c),n(15,c.mask=A((e=>e instanceof ge&&0===e.getAngleDeg())),c),n(16,u.minVal=.1,u),n(16,u.maxVal=.6,u),n(16,u.mask=A((e=>e instanceof ge&&270===e.getAngleDeg())),u),n(11,m="mirror");for(let e=0;e<10;e++)F()}};return e.$$set=e=>{"engine"in e&&n(5,x=e.engine),"frameSize"in e&&n(2,w=e.frameSize),"frameMode"in e&&n(0,$=e.frameMode),"itersPerFrame"in e&&n(1,_=e.itersPerFrame),"onResize"in e&&n(33,b=e.onResize),"onScreenshot"in e&&n(6,k=e.onScreenshot),"wrapElem"in e&&n(3,E=e.wrapElem),"isShown"in e&&n(4,M=e.isShown),"$$scope"in e&&n(34,v=e.$$scope)},e.$$.update=()=>{1824&e.$$.dirty[0]|4&e.$$.dirty[1]&&i&&r!==o&&(n(10,r=o),x.resize(o,r),b()),512&e.$$.dirty[0]&&n(13,l=Math.floor(Math.log2(o))),1024&e.$$.dirty[0]&&n(14,s=Math.floor(Math.log2(r))),2048&e.$$.dirty[0]&&T().setWrapMode(m),1&e.$$.dirty[0]&&T().toggleFrame("darken"===$),128&e.$$.dirty[0]&&T().setColorMode(S),2&e.$$.dirty[0]&&n(20,p=function(e){if(e<=1)return e;const t=Math.floor(Math.log2(e));return 2*t+(e-Math.pow(2,t)<Math.pow(2,t-1)?0:1)}(_))},n(8,i=T().getSize()[0]===T().getSize()[1]),n(12,a=Math.floor(Math.log2(T().getMaxFieldSize()))),n(9,o=T().getSize()[0]),n(10,r=T().getSize()[1]),n(15,c=T().getCoefs().diffusionRateA),n(16,u=T().getCoefs().diffusionRateB),n(17,f=T().getCoefs().killRate),n(18,d=T().getCoefs().feedRate),n(19,h=T().getCoefs().timeDelta),n(11,m=T().getWrapMode()),[$,_,w,E,M,x,k,S,i,o,r,m,a,l,s,c,u,f,d,h,p,e=>{n(9,o=Math.pow(2,+e.currentTarget.value)),i&&n(10,r=o),x.resize(o,r),b()},e=>{n(10,r=Math.pow(2,+e.currentTarget.value)),x.resize(o,r),b()},()=>x.updateIterationData(),e=>n(1,_=function(e){if(e<=1)return e;const t=Math.pow(2,Math.floor(e/2));return t+(e%2==0?0:t/2)}(+e.currentTarget.value)),function(e){"Escape"===e.key&&n(4,M=!M)},R,V,C,F,D,B,function(){D((()=>{const e={diffusionRateA:[.2,1],diffusionRateB:[.1,.8],feedRate:[.005,.12],killRate:[.035,.07],timeDelta:[.8,1]},t=x.getMasks(),n=t.find((e=>e instanceof pe));for(const[i,a]of Object.entries(x.getCoefs())){const o=Math.random()>.8?n:t[Math.random()*t.length|0];a.mask=o;const[r,l]=e[i];a.maxVal=r+Math.random()*(l-r),a.minVal=o===n?a.maxVal:r+Math.random()*(l-r)}Math.random()<.25?R(1+3.999*Math.random()|0):Math.random()<.333?V():Math.random()<.5?C():F()}))},b,v,g,()=>n(4,M=!1),()=>n(4,M=!0),e=>D(e),function(){S=this.__value,n(7,S)},[[],[],[]],function(){S=this.__value,n(7,S)},function(){S=this.__value,n(7,S)},function(){S=this.__value,n(7,S)},function(){S=this.__value,n(7,S)},function(){S=this.__value,n(7,S)},function(){S=this.__value,n(7,S)},function(){S=this.__value,n(7,S)},()=>x.clear(),()=>R(1),()=>R(2),()=>R(3),function(e){c=e,n(15,c),n(65,T)},function(e){u=e,n(16,u),n(65,T)},function(e){d=e,n(18,d),n(65,T)},function(e){f=e,n(17,f),n(65,T)},function(e){h=e,n(19,h),n(65,T)},function(){i=this.checked,n(8,i),n(65,T)},function(){m=this.__value,n(11,m),n(65,T)},function(){m=this.__value,n(11,m),n(65,T)},function(){$=this.__value,n(0,$)},function(){$=this.__value,n(0,$)},function(){$=this.__value,n(0,$)},function(){var e;e=this.value,w=""===e?null:+e,n(2,w)},function(e){y[e?"unshift":"push"]((()=>{E=e,n(3,E)}))}]}class mt extends Z{constructor(e){super(),K(this,e,ht,dt,o,{engine:5,frameSize:2,frameMode:0,itersPerFrame:1,onResize:33,onScreenshot:6,wrapElem:3,isShown:4},[-1,-1,-1])}}function pt(t){let n,i=t[0].toFixed(0)+"";return{c(){n=m(i)},m(e,t){u(e,n,t)},p(e,[t]){1&t&&i!==(i=e[0].toFixed(0)+"")&&x(n,i)},i:e,o:e,d(e){e&&f(n)}}}function gt(e,t,n){let i=0,a=Date.now(),o=0,r=[],{average:l=1}=t;return e.$$set=e=>{"average"in e&&n(1,l=e.average)},[i,l,function(e){o+=e||1;const t=Date.now(),s=t-a;if(s>=1e3){if(l<=1)n(0,i=o);else{r.push(o),r.length>l&&r.shift();let e=0;for(let t=0;t<r.length;t++)e+=r[t];n(0,i=e/r.length)}a=s<2e3?a-1e3:t,a=t,o=0}}]}class vt extends Z{constructor(e){super(),K(this,e,gt,pt,o,{average:1,frame:2})}get frame(){return this.$$.ctx[2]}}function xt(e){let t,n,i,a,o,r,l;function s(t){e[17](t)}function c(t){e[18](t)}function u(t){e[19](t)}function f(t){e[20](t)}function d(t){e[21](t)}let h={engine:e[7],onResize:e[13],onScreenshot:e[12],$$slots:{ips:[$t],fps:[wt]},$$scope:{ctx:e}};return void 0!==e[1]&&(h.wrapElem=e[1]),void 0!==e[10]&&(h.isShown=e[10]),void 0!==e[2]&&(h.frameSize=e[2]),void 0!==e[0]&&(h.frameMode=e[0]),void 0!==e[8]&&(h.itersPerFrame=e[8]),t=new mt({props:h}),y.push((()=>G(t,"wrapElem",s))),y.push((()=>G(t,"isShown",c))),y.push((()=>G(t,"frameSize",u))),y.push((()=>G(t,"frameMode",f))),y.push((()=>G(t,"itersPerFrame",d))),{c(){q(t.$$.fragment)},m(e,n){Y(t,e,n),l=!0},p(e,l){const s={};128&l&&(s.engine=e[7]),1073741848&l&&(s.$$scope={dirty:l,ctx:e}),!n&&2&l&&(n=!0,s.wrapElem=e[1],D((()=>n=!1))),!i&&1024&l&&(i=!0,s.isShown=e[10],D((()=>i=!1))),!a&&4&l&&(a=!0,s.frameSize=e[2],D((()=>a=!1))),!o&&1&l&&(o=!0,s.frameMode=e[0],D((()=>o=!1))),!r&&256&l&&(r=!0,s.itersPerFrame=e[8],D((()=>r=!1))),t.$set(s)},i(e){l||(H(t.$$.fragment,e),l=!0)},o(e){X(t.$$.fragment,e),l=!1},d(e){W(t,e)}}}function wt(e){let t,n,i;return n=new vt({props:{}}),e[16](n),{c(){t=h("span"),q(n.$$.fragment),v(t,"slot","fps")},m(e,a){u(e,t,a),Y(n,t,null),i=!0},p(e,t){n.$set({})},i(e){i||(H(n.$$.fragment,e),i=!0)},o(e){X(n.$$.fragment,e),i=!1},d(i){i&&f(t),e[16](null),W(n)}}}function $t(e){let t,n,i;return n=new vt({props:{average:5}}),e[15](n),{c(){t=h("span"),q(n.$$.fragment),v(t,"slot","ips")},m(e,a){u(e,t,a),Y(n,t,null),i=!0},p(e,t){n.$set({})},i(e){i||(H(n.$$.fragment,e),i=!0)},o(e){X(n.$$.fragment,e),i=!1},d(i){i&&f(t),e[15](null),W(n)}}}function _t(e){let t,n;return t=new Ne({props:{origin:e[9],$$slots:{default:[bt]},$$scope:{ctx:e}}}),{c(){q(t.$$.fragment)},m(e,i){Y(t,e,i),n=!0},p(e,n){const i={};512&n&&(i.origin=e[9]),1073741824&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i(e){n||(H(t.$$.fragment,e),n=!0)},o(e){X(t.$$.fragment,e),n=!1},d(e){W(t,e)}}}function bt(e){let t,n,i;return{c(){t=m("Так сохранить картинку, возможно,"),n=h("br"),i=m(" не получится. Вверху есть кнопка.")},m(e,a){u(e,t,a),u(e,n,a),u(e,i,a)},d(e){e&&f(t),e&&f(n),e&&f(i)}}}function kt(e){let t,n,a,o,r,l,s,d=e[7]&&xt(e),m=e[9]&&_t(e);return{c(){d&&d.c(),t=p(),n=h("div"),a=h("canvas"),o=p(),m&&m.c(),v(a,"class","main-canvas svelte-mcfxvm"),v(a,"style",e[11]),b(a,"fullsize","hidden"!==e[0]),v(n,"class","draw-region svelte-mcfxvm")},m(i,f){d&&d.m(i,f),u(i,t,f),u(i,n,f),c(n,a),e[22](a),c(n,o),m&&m.m(n,null),e[25](n),r=!0,l||(s=[g(window,"resize",e[13]),g(a,"contextmenu",e[23]),g(a,"mousemove",e[24])],l=!0)},p(e,[i]){e[7]?d?(d.p(e,i),128&i&&H(d,1)):(d=xt(e),d.c(),H(d,1),d.m(t.parentNode,t)):d&&(U(),X(d,1,1,(()=>{d=null})),N()),(!r||2048&i)&&v(a,"style",e[11]),1&i&&b(a,"fullsize","hidden"!==e[0]),e[9]?m?(m.p(e,i),512&i&&H(m,1)):(m=_t(e),m.c(),H(m,1),m.m(n,null)):m&&(U(),X(m,1,1,(()=>{m=null})),N())},i(e){r||(H(d),H(m),r=!0)},o(e){X(d),X(m),r=!1},d(a){d&&d.d(a),a&&f(t),a&&f(n),e[22](null),m&&m.d(),e[25](null),l=!1,i(s)}}}function Et(e,t,n){let i,a,o,r=null,l=null,s=null,c="darken",u=24,f=null,d=null;const h={x:0,y:0,width:1,height:1};let m=.2,p=!0,g=p;var v;function x(){if(null===s)return;const[e,t]=s.getSize(),i=a.getBoundingClientRect(),r=Math.round(i.width*devicePixelRatio),l=Math.round(i.height*devicePixelRatio),u=i.width/i.height;let d,p;if(u>e/t){const e=t*(1+2*m);e<=l&&"hidden"!==c?(d=u*e,p=e):(d=r,p=l)}else{const t=e*(1+2*m);t<=r&&"hidden"!==c?(d=t,p=t/u):(d=r,p=l)}const g=(f?f.getBoundingClientRect().width:0)/i.width*d,v=Math.min(d/e,p/t)/(1+2*m);n(14,h.x=Math.floor((d-e*v+g)/2),h),n(14,h.x=Math.min(h.x,Math.floor(d-e*v)),h),n(14,h.y=Math.floor((p-t*v)/2),h),n(14,h.width=e*v,h),n(14,h.height=t*v,h),"hidden"===c?(n(6,o.width=e,o),n(6,o.height=t,o)):(n(6,o.width=d,o),n(6,o.height=p,o))}function w(e,t){if(!s)return[e,t];if("hidden"===c){const n=devicePixelRatio/(h.width/o.width);return[e*n,t*n]}{const[n]=s.getSize(),i=a.getBoundingClientRect(),r=o.width/i.width,l=n/h.width;return[(e*r-h.x)*l,(t*r-h.y)*l]}}v=()=>{g!==p&&x(),g=p},M().$$.after_update.push(v),S((()=>{const e=o.getContext("webgl",{antialias:!0,depth:!1,alpha:!1,stencil:!1});if(null===e)return alert("webgl not available");try{n(7,s=new Te(e,512,512))}catch(e){return void alert(e+"")}const t=s;for(let e=0;e<200;e++)t.drawDot(512*Math.random(),512*Math.random());n(0,c=t.isFrameVisible()?"darken":"visible"),x(),function e(){requestAnimationFrame(e);const n=$;null!==n&&n.upd<Date.now()-250&&t.drawDot(...w(n.x,n.y)),t.iter(u),l&&l.frame(u),t.draw("hidden"===c?null:h),r&&r.frame()}()}));let $=null;S((()=>{const e=ye({startElem:a,offsetElem:o,callbacks:{singleDown:(e,t,n,i)=>($={x:n,y:i,upd:Date.now()},s&&s.drawDot(...w(n,i)),!0),singleMove(e,t,n,i){const a=$;return s&&s.drawLine(...w(a.x,a.y),...w(n,i)),a.x=n,a.y=i,a.upd=Date.now(),!0},singleUp:(e,t)=>($=null,!0)}});return()=>e.off()}));return e.$$.update=()=>{7&e.$$.dirty&&m==m&&c&&f&&x(),16385&e.$$.dirty&&n(11,i="hidden"===c?`left: ${h.x/devicePixelRatio}px; top: ${h.y/devicePixelRatio}px; width: ${h.width/devicePixelRatio}px; height: ${h.height/devicePixelRatio}px;`:"")},[c,f,m,r,l,a,o,s,u,d,p,i,function(){if(!s)return;const[e,t]=s.getSize();n(6,o.width=e,o),n(6,o.height=t,o),s.draw(null),o.toBlob((e=>{const t=document.createElement("a");t.download="reaction-diffusion.png",document.body.appendChild(t);const n=URL.createObjectURL(e);t.href=n,t.click(),document.body.removeChild(t),URL.revokeObjectURL(n)}),"image/png"),x()},function(){x()},h,function(e){y[e?"unshift":"push"]((()=>{l=e,n(4,l)}))},function(e){y[e?"unshift":"push"]((()=>{r=e,n(3,r)}))},function(e){f=e,n(1,f)},function(e){p=e,n(10,p)},function(e){m=e,n(2,m)},function(e){c=e,n(0,c)},function(e){u=e,n(8,u)},function(e){y[e?"unshift":"push"]((()=>{o=e,n(6,o)}))},e=>n(9,d={left:e.clientX,top:e.clientY}),()=>n(9,d=null),function(e){y[e?"unshift":"push"]((()=>{a=e,n(5,a)}))}]}return new class extends Z{constructor(e){super(),K(this,e,Et,kt,o,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=index.dab809c7.js.map
